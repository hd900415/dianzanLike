/* 橘子科技旗下 A4源码  https://an4.net 搭建二开联系 QQ 3479863005  纸飞机联系 @orangetech */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0b3b804e"],{"66ea":function(e,i,t){"use strict";(function(e){i["a"]={name:"Scan",components:{},props:{},data(){return{scanType:0,videoObj:null,isUserMedia:!1,gCanvas:null,gCtx:null,conH:"",navH:"",isPlus:window.plus,scan:""}},computed:{isCanvasSupported(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}},watch:{},created(){},mounted(){this.navH=e(this.$el).find(".van-nav-bar").outerHeight()+"px",this.conH=e(window).height()-e(this.$el).find(".van-nav-bar").outerHeight()+"px",window.plus?this.$nextTick(()=>{this.initDeviceScan()}):this.isCanvasSupported&&window.File&&window.FileReader?(this.initCanvas(),qrcode.callback=this.readCode,this.initScan()):this.$MiDialog.Alert("你的设备不支持扫一扫功能")},activated(){},destroyed(){this.scan.close()},methods:{onClickBack(){this.$router.go(-1),this.$route.params.isBack=!0,this.scan.close()},onReadImg(e){this.handleFiles(e.file)},initCanvas(){this.gCanvas=document.getElementById("qr-canvas"),this.gCanvas.style.width="800px",this.gCanvas.style.height="600px",this.gCanvas.width=800,this.gCanvas.height=600,this.gCtx=this.gCanvas.getContext("2d"),this.gCtx.clearRect(0,0,800,600)},initScan(){var e=!0;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)try{navigator.mediaDevices.enumerateDevices().then(i=>{i.forEach(i=>{"videoinput"===i.kind&&i.label.toLowerCase().search("back")>-1&&(e={deviceId:{exact:i.deviceId},facingMode:"environment"})}),this.openCamera(e)})}catch(i){console.log(i)}else console.log("No navigator.mediaDevices.enumerateDevices"),this.openCamera(e)},openCamera(e){console.log(e),1!=this.scanType?(this.videoObj=document.getElementById("Video"),navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:e,audio:!1}).then(e=>{this.cameraSuccess(e)}).catch(e=>{this.cameraError(e)}):navigator.getUserMedia?navigator.getUserMedia({video:e,audio:!1},this.cameraSuccess,this.cameraError):navigator.webkitGetUserMedia&&navigator.webkitGetUserMedia({video:e,audio:!1},this.cameraSuccess,this.cameraError),this.scanType=1,setTimeout(this.captureToCanvas,500)):setTimeout(this.captureToCanvas,500)},cameraSuccess(e){this.videoObj.style.visibility="visible",this.videoObj.srcObject=e,this.videoObj.play(),this.isUserMedia=!0,setTimeout(this.captureToCanvas,500)},cameraError(e){console.log(e.message),e.message.indexOf("Requested device not found")>-1?this.$MiDialog.Alert("你的设备没有相机，可以使用相册选择二维码解析"):e.message.indexOf("Only secure origins are allowed")>-1?this.$MiDialog.Alert("请以HTTPS形式访问聊天，才能获取打开摄像头权限"):e.message.indexOf("Permission denied")>-1?this.$MiDialog.Alert("你未授权密聊使用摄像头，清除浏览器缓存或重启APP可重新设置"):this.$MiDialog.Alert(e.message),this.isUserMedia=!1},captureToCanvas(){if(1==this.scanType&&this.isUserMedia)try{this.gCtx.drawImage(this.videoObj,0,0);try{qrcode.decode()}catch(e){console.log(e),setTimeout(this.captureToCanvas,500)}}catch(e){console.log(e),setTimeout(this.captureToCanvas,500)}},readCode(e){var i=ApiUrl.replace("https://www.","").replace("http://www.","");e.indexOf(i)>-1&&(e.indexOf("friendInfo?mid")>0||e.indexOf("groupInfo?gid")>0)?(e.indexOf("friendInfo?mid")>0&&this.$router.push({name:"friendInfo",query:{mid:e.split("mid=")[1]}}),e.indexOf("groupInfo?gid")>0&&this.$router.push({name:"groupInfo",query:{gid:e.split("gid=")[1]}})):window.plus?plus.nativeUI.alert("你扫描的二维码不是密聊二维码",()=>{this.scan.start()}):this.$MiDialog.Alert("你扫描的二维码不是密聊二维码",()=>{setTimeout(this.captureToCanvas,500)})},handleFiles(e){var i=new FileReader;i.onload=(e=>e=>{this.gCtx.clearRect(0,0,800,600),qrcode.decode(e.target.result)})(),i.readAsDataURL(e)},initDeviceScan(){this.scan=new plus.barcode.Barcode("DeviceVideo",[plus.barcode.QR],{frameColor:"#03b703",scanbarColor:"#03b703"}),this.scan.start(),this.scan.onmarked=this.onMarked,this.scan.onerror=this.onError},onMarked(e,i){i=i.replace(/\n|"|'/g,""),this.readCode(i)},onError(e){plus.nativeUI.alert("无法识别此二维码，请重试",()=>{this.scan.start()})},scanPicture(){this.scan.cancel(),plus.gallery.pick(e=>{plus.barcode.scan(e,this.onMarked,this.onError,[plus.barcode.QR])},e=>{this.scan.start()},{filter:"image"})}}}}).call(this,t("1157"))},"944d":function(e,i,t){"use strict";t.r(i);var a=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"Main",staticStyle:{"background-color":"#000"}},[t("van-nav-bar",{attrs:{title:"扫一扫","right-text":"相册",border:!1},on:{"click-left":e.onClickBack,"click-right":function(e){}}},[t("img",{staticClass:"icon-left",attrs:{slot:"left",src:"./static/miliao/icon/icon-back.svg"},slot:"left"}),e.isPlus?t("a",{staticStyle:{color:"#fff"},attrs:{slot:"right",href:"javascript:;"},on:{click:e.scanPicture},slot:"right"},[e._v("相册")]):t("van-uploader",{attrs:{slot:"right","after-read":e.onReadImg},slot:"right"},[e._v("相册")])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isPlus,expression:"isPlus"}],staticClass:"DeviceVideo",style:{height:e.conH,top:e.navH},attrs:{id:"DeviceVideo"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isPlus,expression:"!isPlus"}],staticClass:"Scan",style:{height:e.conH}},[e._m(0),t("video",{staticClass:"Video",staticStyle:{visibility:"hidden"},attrs:{id:"Video",autoplay:"",height:"100%"}}),t("canvas",{staticStyle:{visibility:"hidden"},attrs:{id:"qr-canvas",width:"800",height:"600"}})])],1)},s=[function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"Camera"},[t("i",{staticClass:"t"}),t("i",{staticClass:"r"}),t("i",{staticClass:"b"}),t("i",{staticClass:"l"}),t("span",[e._v("将二维码放入框内，即可自动扫描")])])}],n=t("66ea"),r=n["a"],o=(t("f95a"),t("2877")),c=Object(o["a"])(r,a,s,!1,null,null,null);i["default"]=c.exports},cbd8:function(e,i,t){},f95a:function(e,i,t){"use strict";var a=t("cbd8"),s=t.n(a);s.a}}]);